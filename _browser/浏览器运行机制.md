### 浏览器是多进程的

浏览器是多进程的，JavaScript是单进程的，浏览器在使用过程中有如下进程在使用

> GPU进程 图像处理器

+ 最多一个 负责3D绘制等

> Browser进程

+ 负责浏览器界面显示，与用户的交互，如前进，后退，刷新等功能
+ 负责各个页面的管理，创建和销毁其他进程
+ 网络资源的管理，下载等

> 第三方插件进程

+ 每种类型的插件对应一个进程，仅当使用该插件时才创建

> 浏览器渲染进程(浏览器内核)

+ 默认每一个tab页就是一个进程
+ 负责界面的渲染，脚步执行和事件处理等

### 浏览器渲染进程是多线程的

每个tab页在渲染界面的时候是单进程渲染的，其中又分为几个线程来完成

> GUI渲染线程 图像用户界面

+ 负责浏览器的界面渲染，包括解析html，css生成dom树和css object model，然后合并成render tree，到最后的layout布局和paint绘制
+ 当界面需要重绘（repaint）或者由于某种操作引发回流（reflow）时，该线程就会执行
+ 注意，GUI线程与js引擎线程是互斥的，当js引擎执行时GUI线程就会被挂起（相当于被冻结了），GUI更新会被保存在一个队列中等到js引擎执行完毕空闲时立即被执行

> js引擎线程

+ 被称为浏览器内核，负责处理JavaScript脚步程序,(例如v8引擎)
+ js引擎负责解析JavaScript脚步代码，并运行代码
+ js引擎一直等待任务队列中任务的到来，然后加以处理，一个tab页中只有一个js线程在运行
+ 同样这里要注意，GUI线程与js线程是互斥的，所以如果JavaScript执行时间过长，需要放到body下面，否则会导致界面渲染阻塞

> 事件触发线程

+ 管理着事件队列
+ 监听事件，符合条件触发事件时把回调函数放入事件队列（任务队列）中，然后在放入主线程执行

> 定时器触发线程

+ setTimeout和setInterval在此线程中执行执行完毕后，会把回调函数注入到事件队列中等待，然后被放入主线程执行
+  浏览器定时器并不是JavaScript引擎计数的，因为JavaScript引擎是单线程的，如果处理阻塞状态会影响计时的准确性，因此通过单独的线程来处计时

> http异步请求线程

+ 通过浏览器xmlHttpRequest对象来处理，当状态发生变化时，把回调函数注入到事件队列中等待执行

!> 事件队列

事件队列是一个存储回调函数的任务队列，当异步的任务执行完毕之后，对应的回调函数就会被注入到事件队列，它里面的任务又分为两种，宏任务和微任务

执行完一个宏任务之后，就会去执行所有的微任务，然后在来执行下一个宏任务

+ 宏任务

 + setTimeout
 + setInterval
 + requestAnimatinFrame

+ 微任务

 + promise.then
 + process.nextTick
 + catch finally

### 浏览器重绘repaint和reflow回流（重排）

+ repaint

当render tree中的一部分（或全部）因为元素的尺寸，布局，隐藏等改变而需要重新构建，这就成为回流，每个节目至少执行一次回流，就是界面初次加载的时候

+ reflow

当render tree中一些元素需要更新新的属性，而这个属性知识影响元素的外观，而不影响布局，比如改变color和background-color，则成为重绘

!> 回流一定会引起重绘，而重绘不一定引起回流


